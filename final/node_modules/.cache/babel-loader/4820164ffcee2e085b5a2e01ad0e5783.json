{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\vscode\\\\webfinalproject\\\\final\\\\final\\\\final\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\vscode\\\\webfinalproject\\\\final\\\\final\\\\final\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _taggedTemplateLiteral from\"C:\\\\vscode\\\\webfinalproject\\\\final\\\\final\\\\final\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\taggedTemplateLiteral.js\";var _templateObject;import _regeneratorRuntime from\"C:\\\\vscode\\\\webfinalproject\\\\final\\\\final\\\\final\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect,useState}from\"react\";import{Button,Modal,Calendar,Typography,Tabs,Table,Popconfirm,message}from\"antd\";import axios from'../axios.js';import moment from\"moment\";import\"../Css/MyCalendar.css\";import{css}from\"@emotion/react\";import RingLoader from'react-spinners/RingLoader';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Title=Typography.Title,Text=Typography.Text;var TabPane=Tabs.TabPane;var override=css(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n  border-color: #971d1d;\\n\"])));var MyCalendar=function MyCalendar(_ref){var username=_ref.username;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),ModalVisible=_useState2[0],setModalVisible=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),SelectDate=_useState4[0],setSelectDate=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),curRecord=_useState6[0],setCurrentRecord=_useState6[1];var _useState7=useState(\"month\"),_useState8=_slicedToArray(_useState7,2),GridMode=_useState8[0],setGridMode=_useState8[1];var Change=false;var columns=[{title:'類別',dataIndex:'type'},{title:'金額(元)',dataIndex:'cost'},{title:'備註',dataIndex:'content'},{title:'',dataIndex:'',render:function render(text,record,index){return curRecord.length>0?/*#__PURE__*/_jsx(Popconfirm,{title:\"Sure to delete?\",onConfirm:function onConfirm(){return onDelete(record._id);},children:/*#__PURE__*/_jsx(\"a\",{href:\"#\",color:\"red\",children:\"Delete\"})}):null;}}];var GetRecord=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,records;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/GetUserInformation',{params:{username:username}});case 2:_yield$axios$get=_context.sent;records=_yield$axios$get.data.records;setCurrentRecord(records);//console.log(records);\ncase 5:case\"end\":return _context.stop();}}},_callee);}));return function GetRecord(){return _ref2.apply(this,arguments);};}();var onDelete=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(index){var _yield$axios$post,_yield$axios$post$dat,Message,NewRecords;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('/api/DeleteRecord',{username:username,_id:index});case 2:_yield$axios$post=_context2.sent;_yield$axios$post$dat=_yield$axios$post.data;Message=_yield$axios$post$dat.Message;NewRecords=_yield$axios$post$dat.NewRecords;setCurrentRecord(NewRecords);//console.log(curRecord);\nmessage.success({content:Message});case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function onDelete(_x){return _ref3.apply(this,arguments);};}();useEffect(function(){GetRecord();},[]);function onPanelChange(value,mode){// console.log(2);\nChange=true;if(mode===\"year\")setGridMode(\"year\");else setGridMode(\"month\");}var showModal=function showModal(value){// console.log(1);\nChange=!Change;if(GridMode===\"month\"&&Change===true){Change=!Change;var DATE=value.format('YYYY-MM-DD');setSelectDate(DATE);//console.log(SelectDate);\nsetModalVisible(true);}};var handleOk=function handleOk(){setModalVisible(false);};var handleCancel=function handleCancel(){setModalVisible(false);};function createTable(status){var arr=curRecord.filter(function(x){return x.date===SelectDate&&x.status===status;}).length===0?'':curRecord.filter(function(x){return x.date===SelectDate&&x.status===status;});//console.log(arr);\nreturn arr;}var dateCellRender=function dateCellRender(value){var eachDate=value.format('YYYY-MM-DD');return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{type:\"danger\",strong:true,children:curRecord.filter(function(x){return x.date===eachDate;}).length===0?'':\"支出: \"}),/*#__PURE__*/_jsx(Text,{type:\"danger\",strong:true,children:curRecord.filter(function(x){return x.date===eachDate;}).length===0?'':curRecord.filter(function(x){return x.date===eachDate&&x.status===\"支出\";}).reduce(function(sum,item){return sum+item.cost;},0)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Text,{type:\"success\",strong:true,children:curRecord.filter(function(x){return x.date===eachDate;}).length===0?'':\"收入: \"}),/*#__PURE__*/_jsx(Text,{type:\"success\",strong:true,children:curRecord.filter(function(x){return x.date===eachDate;}).length===0?'':curRecord.filter(function(x){return x.date===eachDate&&x.status===\"收入\";}).reduce(function(sum,item){return sum+item.cost;},0)})]});};var monthCellRender=function monthCellRender(value){var eachMonth=value.format(\"YYYY-MM\");return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{type:\"danger\",strong:true,children:curRecord.filter(function(x){return x.date_YM===eachMonth;}).length===0?'':\"支出: \"}),/*#__PURE__*/_jsx(Text,{type:\"danger\",strong:true,children:curRecord.filter(function(x){return x.date_YM===eachMonth;}).length===0?'':curRecord.filter(function(x){return x.date_YM===eachMonth&&x.status===\"支出\";}).reduce(function(sum,item){return sum+item.cost;},0)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Text,{type:\"success\",strong:true,children:curRecord.filter(function(x){return x.date_YM===eachMonth;}).length===0?'':\"收入: \"}),/*#__PURE__*/_jsx(Text,{type:\"success\",strong:true,children:curRecord.filter(function(x){return x.date_YM===eachMonth;}).length===0?'':curRecord.filter(function(x){return x.date_YM===eachMonth&&x.status===\"收入\";}).reduce(function(sum,item){return sum+item.cost;},0)})]});};var Model=function Model(){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Modal,{title:SelectDate,visible:ModalVisible,onOk:handleOk,onCancel:handleCancel,children:/*#__PURE__*/_jsxs(Tabs,{defaultActiveKey:\"\\u652F\\u51FA\",centered:true,children:[/*#__PURE__*/_jsx(TabPane,{tab:\"\\u652F\\u51FA\",children:/*#__PURE__*/_jsx(Table,{dataSource:createTable(\"支出\"),columns:columns})},\"支出\"),/*#__PURE__*/_jsx(TabPane,{tab:\"\\u6536\\u5165\",children:/*#__PURE__*/_jsx(Table,{dataSource:createTable(\"收入\"),columns:columns})},\"收入\")]})})});};var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];useEffect(function(){var loadData=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return new Promise(function(r){return setTimeout(r,1000);});case 2:setLoading(function(loading){return!loading;});case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function loadData(){return _ref4.apply(this,arguments);};}();loadData();},[]);return loading?/*#__PURE__*/_jsx(\"div\",{style:{position:\"fixed\",top:\"50%\",left:\"50%\",transform:\"translate(-50%, -50%)\"},children:/*#__PURE__*/_jsx(RingLoader,{color:\"#971d1d\",css:override,size:100})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Calendar,{onPanelChange:onPanelChange,dateCellRender:dateCellRender,monthCellRender:monthCellRender,onSelect:showModal}),ModalVisible?Model():'']});};export default MyCalendar;","map":{"version":3,"sources":["C:/vscode/webfinalproject/final/final/final/src/Containers/MyCalendar.js"],"names":["React","useEffect","useState","Button","Modal","Calendar","Typography","Tabs","Table","Popconfirm","message","axios","moment","css","RingLoader","Title","Text","TabPane","override","MyCalendar","username","ModalVisible","setModalVisible","SelectDate","setSelectDate","curRecord","setCurrentRecord","GridMode","setGridMode","Change","columns","title","dataIndex","render","text","record","index","length","onDelete","_id","GetRecord","get","params","records","data","post","Message","NewRecords","success","content","onPanelChange","value","mode","showModal","DATE","format","handleOk","handleCancel","createTable","status","arr","filter","x","date","dateCellRender","eachDate","reduce","sum","item","cost","monthCellRender","eachMonth","date_YM","Model","loading","setLoading","loadData","Promise","r","setTimeout","position","top","left","transform"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Button, Modal, Calendar, Typography, Tabs, Table, Popconfirm, message } from \"antd\";\r\nimport axios from '../axios.js'\r\nimport moment from \"moment\";\r\nimport \"../Css/MyCalendar.css\";\r\nimport { css } from \"@emotion/react\";\r\nimport RingLoader from 'react-spinners/RingLoader'\r\nconst { Title, Text } = Typography;\r\nconst { TabPane } = Tabs;\r\n\r\nconst override = css`\r\n  display: flex;\r\n  border-color: #971d1d;\r\n`;\r\n\r\nconst MyCalendar = ({ username }) => {\r\n  const [ModalVisible, setModalVisible] = useState(false);\r\n  const [SelectDate, setSelectDate] = useState(\"\");\r\n  const [curRecord, setCurrentRecord] = useState([]);\r\n  const [GridMode, setGridMode] = useState(\"month\");\r\n  let Change = false;\r\n  const columns = [\r\n    {\r\n      title: '類別',\r\n      dataIndex: 'type',\r\n    }, {\r\n      title: '金額(元)',\r\n      dataIndex: 'cost',\r\n    }, {\r\n      title: '備註',\r\n      dataIndex: 'content',\r\n    }, {\r\n      title: '',\r\n      dataIndex: '',\r\n      render: (text, record, index) => {\r\n        return (\r\n          curRecord.length > 0 ?\r\n            (\r\n              <Popconfirm title=\"Sure to delete?\" onConfirm={() => onDelete(record._id)}>\r\n                <a href=\"#\" color=\"red\">Delete</a>\r\n              </Popconfirm>\r\n            ) : null\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const GetRecord = async () => {\r\n    const { data: { records } } = await axios.get('/api/GetUserInformation', {\r\n      params: {\r\n        username,\r\n      },\r\n    });\r\n    setCurrentRecord(records);\r\n    //console.log(records);\r\n  };\r\n\r\n  const onDelete = async (index) => {\r\n    // console.log(username, curRecord[index].date, curRecord[index].status, curRecord[index].content, curRecord[index].type);\r\n    const { data: { Message, NewRecords } } = await axios.post('/api/DeleteRecord', {\r\n      username: username,\r\n      _id: index,\r\n    });\r\n    setCurrentRecord(NewRecords);\r\n    //console.log(curRecord);\r\n    message.success({\r\n      content: Message\r\n    })\r\n\r\n  };\r\n\r\n  useEffect(() => {\r\n    GetRecord();\r\n  }, []);\r\n\r\n  function onPanelChange(value, mode) {\r\n    // console.log(2);\r\n    Change = true;\r\n    if (mode === \"year\")\r\n      setGridMode(\"year\");\r\n    else\r\n      setGridMode(\"month\");\r\n  }\r\n\r\n  const showModal = (value) => {\r\n    // console.log(1);\r\n    Change = !Change;\r\n    if (GridMode === \"month\" && Change === true) {\r\n      Change = !Change;\r\n      const DATE = value.format('YYYY-MM-DD');\r\n      setSelectDate(DATE);\r\n      //console.log(SelectDate);\r\n      setModalVisible(true);\r\n    }\r\n  };\r\n\r\n  const handleOk = () => {\r\n    setModalVisible(false);\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setModalVisible(false);\r\n  };\r\n\r\n  function createTable(status) {\r\n    let arr = curRecord.filter((x) => { return x.date === SelectDate && x.status === status }).length === 0 ?\r\n      '' :\r\n      curRecord.filter((x) => { return x.date === SelectDate && x.status === status });\r\n    //console.log(arr);\r\n    return arr;\r\n  }\r\n\r\n  const dateCellRender = (value) => {\r\n    const eachDate = value.format('YYYY-MM-DD');\r\n    return (\r\n      <>\r\n        <Text type=\"danger\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date === eachDate }).length === 0 ? '' : \"支出: \"}\r\n        </Text>\r\n        <Text type=\"danger\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date === eachDate }).length === 0 ?\r\n            '' : curRecord.filter((x) => { return (x.date === eachDate && x.status === \"支出\") }).reduce((sum, item) =>\r\n              sum + item.cost, 0)\r\n          }\r\n        </Text>\r\n        <br></br>\r\n        <Text type=\"success\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date === eachDate }).length === 0 ? '' : \"收入: \"}\r\n        </Text>\r\n        <Text type=\"success\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date === eachDate }).length === 0 ?\r\n            '' : curRecord.filter((x) => { return (x.date === eachDate && x.status === \"收入\") }).reduce((sum, item) =>\r\n              sum + item.cost, 0)\r\n          }\r\n        </Text>\r\n      </>\r\n    )\r\n  };\r\n\r\n  const monthCellRender = (value) => {\r\n    const eachMonth = value.format(\"YYYY-MM\");\r\n    return (\r\n      <>\r\n        <Text type=\"danger\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date_YM === eachMonth }).length === 0 ? '' : \"支出: \"}\r\n        </Text>\r\n        <Text type=\"danger\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date_YM === eachMonth }).length === 0 ?\r\n            '' : curRecord.filter((x) => { return (x.date_YM === eachMonth && x.status === \"支出\") }).reduce((sum, item) =>\r\n              sum + item.cost, 0)\r\n          }\r\n        </Text>\r\n        <br></br>\r\n        <Text type=\"success\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date_YM === eachMonth }).length === 0 ? '' : \"收入: \"}\r\n        </Text>\r\n        <Text type=\"success\" strong={true}>\r\n          {curRecord.filter((x) => { return x.date_YM === eachMonth }).length === 0 ?\r\n            '' : curRecord.filter((x) => { return (x.date_YM === eachMonth && x.status === \"收入\") }).reduce((sum, item) =>\r\n              sum + item.cost, 0)\r\n          }\r\n        </Text>\r\n      </>\r\n    )\r\n  }\r\n\r\n  const Model = () => {\r\n    return (\r\n      <>\r\n        <Modal\r\n          title={SelectDate}\r\n          visible={ModalVisible}\r\n          onOk={handleOk}\r\n          onCancel={handleCancel}\r\n        >\r\n          <Tabs defaultActiveKey=\"支出\" centered >\r\n            <TabPane tab=\"支出\" key=\"支出\">\r\n              <Table dataSource={createTable(\"支出\")} columns={columns} />\r\n            </TabPane>\r\n            <TabPane tab=\"收入\" key=\"收入\">\r\n              <Table dataSource={createTable(\"收入\")} columns={columns} />\r\n            </TabPane>\r\n          </Tabs>\r\n        </Modal>\r\n      </>\r\n    )\r\n  }\r\n  const [loading, setLoading] = useState(true)\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      await new Promise((r) => setTimeout(r, 1000))\r\n      setLoading((loading) => !loading)\r\n    }\r\n    loadData()\r\n  }, [])\r\n  return loading ? (\r\n    <div style={{ position: \"fixed\", top: \"50%\", left: \"50%\", transform: \"translate(-50%, -50%)\" }}>\r\n      <RingLoader color=\"#971d1d\" css={override} size={100} />\r\n    </div>) : (\r\n    <>\r\n      <Calendar\r\n        onPanelChange={onPanelChange}\r\n        dateCellRender={dateCellRender}\r\n        monthCellRender={monthCellRender}\r\n        onSelect={showModal}\r\n      />\r\n      {ModalVisible ? Model() : ''}\r\n    </>\r\n\r\n  );\r\n}\r\nexport default MyCalendar;\r\n"]},"metadata":{},"sourceType":"module"}